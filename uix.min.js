var _Store_value,_Store_subscribers,__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(e,t,i,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,i):r?r.value=i:t.set(e,i),i},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)};String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){if("string"!=typeof e||""===e)return this.toString();const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(i,"g");return this.replace(s,t)});export const $=(e,t=!1,i=document)=>t?i.querySelectorAll(e):i.querySelector(e);export const renderPage=()=>{documentReady.value=!1,renderBraces(),evaluateDirectives(),evaluateBraceAttributes(),documentReady.value=!0};export const silentRerenderPage=()=>{renderBraces(),evaluateDirectives(),evaluateBraceAttributes()};const attributesToObject=e=>{let t={};for(let i=0;i<e.length;i++){const s=e[i];t[s.name]=s.value}return t};export const CreateComponent=(e,t)=>{var i,s,r,n;const a=(null==t?void 0:t.name)||"uix-"+e.name,o=(null==t?void 0:t.useFrames)||!0;class c extends HTMLElement{constructor(){super(),i.set(this,void 0),s.set(this,void 0),r.set(this,void 0),n.set(this,void 0),componentPlugins.forEach((e=>{e(this)})),__classPrivateFieldSet(this,r,{},"f"),this.frames=[],this.renderCount=0,__classPrivateFieldSet(this,s,[],"f"),__classPrivateFieldSet(this,n,[],"f"),this.parent=this.parentElement||document.body;const a=this.attachShadow({mode:(null==t?void 0:t.shadowMode)||"open"});__classPrivateFieldSet(this,i,a,"f"),o&&this.frames.push({html:this.innerHTML,attributes:this.attributes,shadowHTML:__classPrivateFieldGet(this,i,"f").innerHTML});const c=attributesToObject(this.attributes),l=e.call(this,c,__classPrivateFieldGet(this,i,"f"),{render:this.render.bind(this),createState:this.createState.bind(this),getState:this.getState.bind(this),onInit:this.onInit.bind(this),setState:this.setState.bind(this),getThis:this.getThis.bind(this)});__classPrivateFieldGet(this,i,"f").innerHTML=l||this.innerHTML,t&&(t.renderOnChange&&this.addEventListener("change",(e=>{this.render()})),t.renderOnInput&&this.addEventListener("input",(e=>{this.render()}))),setTimeout((()=>{__classPrivateFieldGet(this,n,"f").forEach((e=>{e()}))}))}connectedCallback(){(null==t?void 0:t.connectedCallback)&&t.connectedCallback(this),setTimeout((()=>{this.render()}))}disconnectedCallback(){(null==t?void 0:t.disconnectedCallback)&&t.disconnectedCallback(this)}createState(e,t){__classPrivateFieldGet(this,r,"f")[e]=new Store(t)}setState(e,t){__classPrivateFieldGet(this,r,"f")[e].value=t}getState(e,t){let i=!1;try{const s=__classPrivateFieldGet(this,r,"f")[e].value;return void 0===s?(i=!0,console.log(s),console.error("UIX: State undefined. Did you define it? A store-like object will be returned. Use fallbackValue parameter to set it's value."),{value:t||null,subscribe(e){},unsubscribe(e){}}):__classPrivateFieldGet(this,r,"f")[e]}catch(e){return i||console.warn(`UIX (internal error): ${e}\n\nA store-like object will be returned.\nA common fix is to wrap a getState call like this (if in a template literal, remove semicolons): (()=>{try{getState('name-of-state').[property]}catch{return "fallback value here"}})();\n\nYou can easily provide a fallback value by passing it as the second argument to the getState function. This will be the value of the store-like object that will be returned.\nThis is a common error, as it mostly happens when you define a state after the component has already been rendered at least once.`),{value:t||0,subscribe(e){console.warn("UIX: You subscribed to a store-like object. You can check if an object is store-like by checking its storeLike property. This is null when it is a real Store.")},unsubscribe(e){console.warn("UIX: You subscribed to a store-like object. You can check if an object is store-like by checking its storeLike property. This is null when it is a real Store.")},storeLike:!0}}}onInit(e){__classPrivateFieldGet(this,n,"f").push(e.bind(this))}getThis(){return this}render(){try{__classPrivateFieldGet(this,s,"f").forEach((e=>{e()}))}catch(e){throw new Error(`UIX: Failed to alert onRender subscribers, so the component will NOT be rendered. The most common cause of this error is that you are storing a component's render function in a variable or passing it to another function. Do not do this. You should instead find the element with something like document.querySelector or $. Then call render on that. Error that caused the issue:\n\n${e}`)}const r=attributesToObject(this.attributes),n=e.call(this,r,__classPrivateFieldGet(this,i,"f"),{render:this.render.bind(this),createState:this.createState.bind(this),getState:this.getState.bind(this),onInit:this.onInit.bind(this),setState:this.setState.bind(this),getThis:this.getThis.bind(this)});o&&this.frames.push({html:this.innerHTML,attributes:this.attributes,shadowHTML:__classPrivateFieldGet(this,i,"f").innerHTML}),componentRenderPlugins.forEach((e=>{e(this,t)})),__classPrivateFieldGet(this,i,"f").innerHTML=n||this.innerHTML,this.renderCount++;const a=new CustomEvent("render",{bubbles:!1,cancelable:!1,detail:{component:this}});this.dispatchEvent(a)}onRender(e){__classPrivateFieldGet(this,s,"f").push(e)}}i=new WeakMap,s=new WeakMap,r=new WeakMap,n=new WeakMap,customElements.define(a,c)};const componentPlugins=[],componentRenderPlugins=[],loadPlugins=[];export const UsePlugin=(e,t)=>{"componentCreate"===t?componentPlugins.push(e):"componentRender"===t?componentRenderPlugins.push(e):"load"===t&&loadPlugins.push(e)};document.addEventListener("load",(e=>{loadPlugins.forEach((e=>{e()}))}));export class Store{constructor(e){_Store_value.set(this,void 0),_Store_subscribers.set(this,void 0),__classPrivateFieldSet(this,_Store_value,e,"f"),__classPrivateFieldSet(this,_Store_subscribers,[],"f")}get value(){return __classPrivateFieldGet(this,_Store_value,"f")}set value(e){__classPrivateFieldGet(this,_Store_subscribers,"f").forEach((e=>{e("beforeChange",__classPrivateFieldGet(this,_Store_value,"f"))})),__classPrivateFieldSet(this,_Store_value,e,"f"),__classPrivateFieldGet(this,_Store_subscribers,"f").forEach((t=>{t("afterChange",e)}))}subscribe(e){__classPrivateFieldGet(this,_Store_subscribers,"f").push(e)}unsubscribe(e){"number"==typeof e?__classPrivateFieldSet(this,_Store_subscribers,__classPrivateFieldGet(this,_Store_subscribers,"f").filter(((t,i)=>i!==e)),"f"):(__classPrivateFieldGet(this,_Store_subscribers,"f").includes(e)||console.error("UIX: Failed to unsubscribe because the function is not in the subscribers array."),__classPrivateFieldSet(this,_Store_subscribers,__classPrivateFieldGet(this,_Store_subscribers,"f").filter((t=>t!==e)),"f"))}clear(){__classPrivateFieldSet(this,_Store_subscribers,[],"f")}}_Store_value=new WeakMap,_Store_subscribers=new WeakMap;class UIX_IF extends HTMLElement{constructor(){super();const e=new Function(`return ${this.getAttribute("exp")}`)();if(null==e)throw new Error("UIX: No exp attribute on an uix-if element.");if(this.exp=String(e),this.showing=!1,this.style.display="none","true"==this.getAttribute("observe")){new MutationObserver((e=>{e.forEach((e=>{if("attributes"==e.type){if(!this.hasAttribute("exp"))throw new Error("UIX: No exp attribute on an uix-if element.");this.exp=new Function(`return ${this.getAttribute("exp")}`)(),this.render(),silentRerenderPage()}}))})).observe(this,{attributes:!0})}this.render()}render(){const e=new Function(`return ${this.getAttribute("exp")}`)();(e instanceof Store?e.value:e)?(this.showing=!0,this.style.display="block"):(this.showing=!1,this.style.display="none")}}customElements.define("uix-if",UIX_IF);export const documentReady=new Store(!1);class UIX_READY extends HTMLElement{constructor(){super(),this.style.display="none",this.showing=documentReady.value;const e=(t,i)=>{"afterChange"!==t||this.showing||(documentReady.unsubscribe(e),this.showing=!0,this.style.display="block")};documentReady.subscribe(e)}}customElements.define("uix-ready",UIX_READY);class UIX_SCRIPT extends HTMLElement{constructor(){super(),this.style.display="none"}connectedCallback(){setTimeout((()=>{this.execute()}))}execute(){const e=this.textContent;if(!e)throw new Error("UIX: Empty script");const t=[$,renderPage,renderBraces,CreateComponent,UsePlugin,evaluateBraceAttributes,evaluateDirectives,silentRerenderPage,setDirectivePrefix];let i=[];t.forEach((e=>{i.push(e.name)}));new Function(i,e).call(this,...t)}}customElements.define("uix-script",UIX_SCRIPT);const skipElements=["script","style","html","head","meta"],renderBraces=()=>{document.querySelectorAll("[data-brace]").forEach((e=>{if(!e.textContent)return;if(e.hasAttribute("data-brace-skip"))return;const t=e.nodeName.toLowerCase();if(skipElements.includes(t))return;const i=/{([^]*?)}/g;i.test(e.textContent)&&(e.setAttribute("uix-html",encodeURI(e.innerHTML)),e.innerHTML=e.innerHTML.replace(i,((t,i)=>{try{const t=new Function(`return ${i}`).call(window);let s=t;return t instanceof Store&&(renderBraceElement(e),s=t.value),null!==s?s:""}catch(e){console.error(`UIX (brace error): ${e}`)}})))}))},renderBraceElement=e=>{const t=decodeURI(e.getAttribute("uix-html")||"");e.innerHTML=t.replace(/{([^]*?)}/g,((t,i)=>{const s=new Function(`return ${i}`).call(window);let r=s;if(r instanceof Store){const t=(i,r)=>{"afterChange"===i&&(s.unsubscribe(t),renderBraceElement(e))};r.subscribe(t),r=r.value||""}return null!==r?r:""}))};let directivePrefix="@";export const setDirectivePrefix=e=>{if(!e)throw new Error("UIX: You must set a prefix for the directive prefix.");directivePrefix=e};const evaluateBraceAttributes=()=>{const e=document.querySelectorAll("*");for(const t of e)for(const e of t.attributes)if(e.value.includes("{")&&e.value.includes("}")){let i=!1,s="",r="";for(let t=0;t<e.value.length;t++)if("{"!==e.value[t])if("}"!==e.value[t])i?s+=e.value[t]:r+=e.value[t];else{i=!1;try{r+=new Function(`return ${s};`)()}catch(e){console.error(e)}s=""}else i=!0,s="";t.setAttribute(e.name,r)}},customDirectives=[],customDirectiveNames=[];export const evaluateDirectives=(e,t=window)=>{const i=["click","keydown","keypress","keyup","ready","load","render","change","input","submit"],s=["bind","bind:checked","readhtml","read"],r=["repeat","if"],n=[...i,...s,...r];(e?[...e]:document.querySelectorAll("*")).forEach((e=>{const a=e.attributes.length;for(let o=0;o<a;o++){const a=e.attributes[o],c=a.name.toLocaleLowerCase();if(!c.includes(directivePrefix))continue;if(""==c.split("@")[1]){console.error(`UIX: Invalid or empty directive on a(n) <${e.nodeName.toLocaleLowerCase()}> element.`);continue}if(!n.includes(c.replace(directivePrefix,""))&&!customDirectiveNames.includes(c.replace(directivePrefix,""))){console.error(`UIX: Directive: ${c} on <${e.nodeName.toLocaleLowerCase()}> is not a valid directive. Valid directives are: ${n.join(", ")}.`);continue}const l=c.split(directivePrefix)[1],u=new Function("e",`${a.value}`).bind(t);if(i.includes(l))e.addEventListener(l,(e=>{"ready"==l?console.warn("The @ready directive is deprecated."):u(e)}));else if(s.includes(l)){const i=e,s=new Function(`return ${a.value}`).call(t);switch(l){case"bind":const t=(e,t)=>{"afterChange"===e&&(i.value=t)};s instanceof Store&&(s.subscribe(t),setTimeout((()=>{i.value=s.value,s.value=i.value}))),i.addEventListener("input",(e=>{s instanceof Store?(s.unsubscribe(t),s.value=i.value,s.subscribe(t)):(window[s]=i.value,i.value=s)}));break;case"bind:checked":const r=(e,t)=>{"afterChange"===e&&(i.value=t)};s instanceof Store&&(s.subscribe(r),setTimeout((()=>{i.checked=s.value,s.value=i.value}))),i.addEventListener("click",(e=>{s instanceof Store?(s.unsubscribe(r),s.value=i.checked,s.subscribe(r)):(window[s]=i.checked,i.value=s)}));break;case"readhtml":const n=(t,i)=>{e.innerHTML=i};if(!(s instanceof Store))throw new Error("UIX: To use the get directive, it must be a store.");s.subscribe(n);break;case"read":const a=(t,i)=>{e.textContent=i};if(!(s instanceof Store))throw new Error("UIX: To use the get directive, it must be a store.");s.subscribe(a);break;default:throw new Error(`UIX: Directive: ${l} is not valid or an error occurred.`)}}else if(r.includes(l))switch(l){case"repeat":const i=new Function(`return ${a.value}`).call(t),s=e.innerHTML;e.setAttribute("uix-plain-html-repeat",s),e.innerHTML="";for(let t=0;t<i;t++)e.innerHTML+=s.replaceAll("[i]",t.toString()).replaceAll("[i1]",(t+1).toString());break;case"if":const r=new Function(`return ${a.value}`).call(t);if(r instanceof Store)r.subscribe(((t,i)=>{e.style.display=i?"block":"none"})),e.style.display=r.value?"block":"none";else{new MutationObserver((i=>{i.forEach((i=>{"attributes"===i.type&&i.target===e&&"@if"===i.attributeName&&(e.style.display=new Function(`return ${e.getAttribute("@if")}`).call(t)?"block":"none")}))})).observe(e,{attributes:!0})}}else if(customDirectiveNames.includes(l)){const t=customDirectiveNames.indexOf(l),i=customDirectives[t];if(i.name!==l)throw new Error(`UIX (internal error): (Custom) Directive mismatch. The directive will not be ran at all. Directive(s): Possibly ${l} or ${i.name}. If these are the same, something has gone terribly wrong.`);const s=a.value;i.callback(s,e)}}}))};export const createCustomDirective=(e,t)=>new Promise(((i,s)=>{try{customDirectiveNames.push(e),customDirectives.push({name:e,callback:t}),i()}catch(e){s(e)}}));export const setDirective=(e,t,i)=>{e.attributes[t]=i};document.addEventListener("DOMContentLoaded",renderPage);
